<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Ephemeral</title>
</head>
<body>
<h1>Ephemeral</h1>
<h2>The short-lived social network</h2>
<textarea id="dump"></textarea>
<script src="/socket.io/socket.io.js"></script>
<script>
port = navigator.mozSocial.getWorker().port;
port.postMessage({topic: 'sidebar.registration'});

var socket = new io.connect(window.location.hostname);
socket.on('news', function (data) {
  console.log(data);
  socket.emit('my other event', { my: 'data' });
});

socket.on('ambient-update', function(data) {
  port.postMessage({topic: 'ambient-update', data: data});
});

socket.on('newsfeed-update', function(data) {
  // update the newsfeed
});

port.onmessage = function(e) {
  var data = e.data;
  var d = document.getElementById("dump");
  d.textContent = data.message + '\n' + d.textContent;
  // Todo, handle the message.
};

</script>
</body>
</html>
