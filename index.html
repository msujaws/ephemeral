<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Ephemeral</title>
<style>
body {
  font-family: 'Lucida Sans Unicode', 'Lucida Grande', sans-serif;
  background-color: #e9e9e9;
  background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAQAAAD9CzEMAAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAACxMAAAsTAQCanBgAAAAJdnBBZwAAADAAAAAwAM7ujFcAAAdzSURBVFjDVdjbddtIEgbgj7Ye+lGOQM0MlAGbEYwdARsRzGwEICKwHQGACHYdAcAIdhwBwAysCLAPKHG80jm8gGCjUfXfioecegWrTvai6pwUsxtOVtWgGnDXOptwNDnaDDoLjoqTm9WEWRfPq0OfilWnYLBoXDSKVS87WnROKFaz0QVZ1ul1ZmS9o+oiW83uVq1VwcyW+jSlLW2pppq2VNKWrmlJJfVpS9c4sqUtXeOzLW0pp5q2NKWSrmlLU8pJyumaprSlmkq6phLrfqxPo2fPvvvDT8/uPsuy0Sc3V1dZ59ns1d2zajb6qjF684cfOn+5qX5ZjZ4Vd7/8gR+effz59OyuKrJfnv1w9+qLi5++yl6tXvFs1FsdHfzCfzy7+uKrN1Xxw1dvvhr95bPvvvmCq6dJ44RBRXFzkk06qxkDbi6y3tmkBhS4oY3e3fRoHWXNoysDLKlPS9rSkpa0pZquaUo1TWlLovI1nvfHKdW0pCX16ZquaUvXlKM3NS2pTzlNSdqStKScSvqQVdnZUYfeSQmYFhy1OJsNOqxWWafRaeP9omicrFbVYtSbbRoFhy2xyhpcFNBoZTR6R0V2cnPCGiA9qnqDmwvBo1km3nVORhfZB0GyHdH7375Lep1eHywoGqOiYEOjOhnddDqd6hZnnc2PrdgrufehpC1N6ZpKWpK0BP77NCVpis/eu7UF5nPqU4nXW6ySU4lXNT0NFmd9sHdWNBaDRac3Y9TaNFZ3JzRRslnVY9AaQxzE3a5gwqGkYrAQCpPNbqE+vQaLwR2zCWdrqE9WtA42x5AYugCux/HDlnZ09M6y1eSs12GOyw4aRY7dZjm2MoYa9TpZq3GxGmWzxYyb1gdaq4yLk2w26ZycVIMzbjb0OGoUs84W+1xNRtkLWo0sW2WDzs0VB2kzqObY2/43W40uisaki00cZEWPhrjobFWc5ag5Z5Pzg81PmzUQv/sAHV5kkznI0uqsLqrVyez8Xl+bLui1Ouq8BA9K9Kxhh+LymyzscrDDMKc+wLkLhjg3p5JK2lKfcrqmEuf3j7X6tKQplbSlpwOuWmdcrDqXqCRnWXbT6h7M3unY66J0d0wBSw8QZ7O7ydFhS2cFl9+8aD99NBlQQ5f2xwa9WTFHm8lGWevsooZQ7GAoPjSyi1nnHjujustms2rEaIi6nq3R1kGxGlHRa5HdnHVeFF1s8+N/n75486dnb158l/HFL9knP/DJzS93n0FVHHzWedP55rtvsbVG9sO/8exu9LcfvhqpD10pv6nP7svX1KclXVNN/aPpfnPqdzVaQrGmNMU3pljnmuwWsYXt751fAjPvi5dU0zVJS6oPe9pNqQ/LL4+tvX9n3+CWnm4WnU4xyEqwIsfjbHI06Qyuga0SQlx0wZDF0VFvJFQrGwIuhy01ek047R6r/vGuVdE+ILgzfv98Mig6fcjf7iGnkJDZzcWKj/enNSz7X970Bt/9IXvT++XNn375W9bpfHN2UPHTTdX4j+ybN2ffHL3iXyqy4our7LClHdOjPhJEH37rcR/ZORxYfJnVGcXF6BSuUYKuY5Cxse7JTprSEp61NzpHm0u06l0uatr+DxTv+Kvx3EerS5K2VNOSDn3aqfJu8UtkicZmMCpax6jsrp/irM6L0W5Xh/DpzsU5LGo3qA/VqHH+zfIbrRo5o2jNerNTYOg9T3M1mpwUq2oyO4bor0YvWo2zQ0ntY+ESPjaEL1WtWXG2qlZZaw/n78bYxZHbQ692fNUH7uySu6XykNt//ksQb2fpFtx+5/r24PQSIv8P/6+pJumatvTx9vTND8VPf3nVuYVivmr8qbjLsi8+WTH6pPHZDaPGs1dvvihunv3t1Ss+Kz4b/dvR0+yoyk4xpdwVN9Wg1RhdzCHZk7P2QbzGZNUbrCYl9DVHhFuNUaZDTflh+82DC7OKF1SDogkzh5Msm+0j1RC9WKILHJToQ8NuOG1o/RRppg+ln7BqTDFKrU5G02+201icXQKUx6DhS1y6Wj0dA3Sd2dkViz2tlTD1KXiwGly0Oqcw1CkMPrsrYUp9sIHqvDO5Ruaf0hJz2BKz1zWQ8G75OfDT/8baLZhckpgoasrBfqmkJxFYdi18eRg3tPZB9l2NiqPeoHOPsbc4WkzWKN3O9rMBrcXqMKXRyd2gelHNblanh9Xv8rW/Gx7LvF+u6B/TxGwkyLhGmG59KLKsVbWyoxt6t+D1LhaVWL6N5WclhHuNDL7Py9mLwTmCcTY69KmGzO3jBvkx1B21bo8QvE8wndWqN8oPe9nlb3WULeGEZRcKT3dHvT2kT45R/SlQMsfNrwG8LnCzq1Fj1aiPGFOjn/fo3WL2NMSYt8fz/rcWTwbZXZWtWlQ1jGY3l6LK0ZeDLYCx/8qx39vNIacpFhzih5ARe4zMMW3uan+OsLhrfg4pv3kJIb8/5s7Rqo20fujTjpB3wnlUdW/TXqRz5I19utnl++RmsBjcvI8ru/W3YTgXmZ0+e7qZwu6mB4Wuj5S0hHi/H9lTdY6QltOWpGvqU45MtIUF/w/LXTUjiJxjJgAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxMi0wMy0xMlQxMzowNToxOCswMTowMHZskaYAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTItMDMtMTJUMTM6MDQ6NTUrMDE6MDANbi0eAAAAAElFTkSuQmCC");
  color: #444;
  padding: 5px;
}

h1 {
  margin-top: 0;
}

#dump {
  display: none;
}

li {
  font-size: 75%;
}
</style>
</head>
<body style="overflow:hidden;">
<h1>Ephemeral</h1>
<p>The short-lived social network</p>

<h2>Recent shares</h2>
<ol id="shares">
</ol>
<textarea id="dump" rows="20"></textarea>
<map id="map">
  <area shape="rect" coords="0,0,119,150" href="javascript:navigator.mozSocial.openChatWindow('/chat1.html')" />
  <area shape="rect" coords="119,0,249,150" href="javascript:navigator.mozSocial.openChatWindow('/chat2.html')" />
  <area shape="rect" coords="0,150,119,296" href="javascript:navigator.mozSocial.openChatWindow('/chat3.html')" />
  <area shape="rect" coords="119,150,249,296" href="javascript:navigator.mozSocial.openChatWindow('/chat4.html')" />
</map>
<img src="people.jpg" usemap="#map" style="position:absolute;bottom:0;left:0;" />
<script src="/socket.io/socket.io.js"></script>
<script type="application/javascript;version=1.8">
port = navigator.mozSocial.getWorker().port;
port.postMessage({topic: 'sidebar.registration'});

function dump(msg) {
  let d = document.getElementById("dump");
  d.textContent = msg + '\n' + d.textContent;
}

let socket = new io.connect(window.location.hostname);
socket.on('news', function (data) {
  console.log(data);
  socket.emit('my other event', { my: 'data' });
});

socket.on('ambient-update', function(data) {
  dump("got ambient-update (sidebar)");
  port.postMessage({topic: 'ambient-update', data: data});
});

socket.on('newsfeed-update', function(data) {
  let s = document.getElementById("shares");
  dump("got newsfeed-udpate (sidebar)");
  let messages = JSON.parse(data.news);
  s.innerHTML = '';
  for (let i = 0; i < messages.length; i++) {
    let li = document.createElement('li');
    let a = document.createElement('a');
    a.setAttribute("href", messages[i]);
    a.textContent = messages[i];
    li.appendChild(a);
    s.appendChild(li);
  }
});

socket.on('new-connection', function(data) {
  if (!panelPort)
    return;
  panelPort.postMessage({topic: 'new-user', data: data.name});
  port.postMessage({topic: 'ambient-update', data: data.name});
});

socket.on('chat1-message-response', function(data) {
  port.postMessage({topic: 'chat1-message-response', data: data});
});

socket.on('chat2-message-response', function(data) {
  port.postMessage({topic: 'chat2-message-response', data: data});
});

socket.on('chat3-message-response', function(data) {
  port.postMessage({topic: 'chat3-message-response', data: data});
});

socket.on('chat4-message-response', function(data) {
  port.postMessage({topic: 'chat4-message-response', data: data});
});

port.onmessage = function(e) {
  let data = e.data;
  dump("Got topic: " + data.topic);

  switch (data.topic) {
    case "share":
      dump("with url: " + data.data.url);
      socket.emit('share', {url: data.data.url});
      break;
    case "unshare":
      dump("with url: " + data.data.url);
      socket.emit('unshare', {url: data.data.url});
      break;
    case "chat1-message":
      dump("with message: " + data.message);
      socket.emit('chat1-message', data.message);
      break;
    case "chat2-message":
      dump("with message: " + data.message);
      socket.emit('chat2-message', data.message);
      break;
    case "chat3-message":
      dump("with message: " + data.message);
      socket.emit('chat3-message', data.message);
      break;
    case "chat4-message":
      dump("with message: " + data.message);
      socket.emit('chat4-message', data.message);
      break;
    case "new-connection":
      dump("with name: " + data.name);
      socket.emit('new-connection', data.name);
      break;
    case "dump":
      dump(data.message);
      break;
    default:
      dump("UNHANDLED TOPIC, " + data.topic);
  }
};

</script>
</body>
</html>
