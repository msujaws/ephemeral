<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Ephemeral</title>
</head>
<body>
<h1>Ephemeral</h1>
<h2>The short-lived social network</h2>
<textarea id="dump" rows="40"></textarea>
<script src="/socket.io/socket.io.js"></script>
<script>
port = navigator.mozSocial.getWorker().port;
port.postMessage({topic: 'sidebar.registration'});

function dump(msg) {
  var d = document.getElementById("dump");
  d.textContent = msg + '\n' + d.textContent;
}

var socket = new io.connect(window.location.hostname);
socket.on('news', function (data) {
  console.log(data);
  socket.emit('my other event', { my: 'data' });
});

socket.on('ambient-update', function(data) {
  port.postMessage({topic: 'ambient-update', data: data});
});

socket.on('newsfeed-update', function(data) {

  // update the newsfeed
});

port.onmessage = function(e) {
  var data = e.data;
  dump("Got topic: " + data.topic);

  switch (data.topic) {
    case "share":
      socket.emit('share', {url: data.url});
      break;
    case "unshare":
      socket.emit('unshare', {url: data.url});
      break;
    case "dump":
      dump(data.message);
      break;
    default:
      dump("UNHANDLED TOPIC, " + data.topic);
  }
};

</script>
</body>
</html>
